### 1. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

GitHub ã‹ã‚‰ **ã‚³ãƒ¼ãƒ‰ï¼Issueï¼PR ã‚³ãƒ¡ãƒ³ãƒˆ** ã‚’å–ã‚Šè¾¼ã¿ã€pgvectorï¼‹Gemini ã§ RAG ã‚’å›ã™ **Next.js (App Router) + TypeScript** ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æœ€å°é››å½¢ã§ã™ã€‚

```
gh-rag/
â”œâ”€ .env.sample              # GITHUB_PAT, DATABASE_URL, GEMINI_API_KEY â€¦
â”œâ”€ package.json
â”œâ”€ tsconfig.json
â”œâ”€ tailwind.config.cjs
â”œâ”€ postcss.config.cjs
â”‚
â”œâ”€ next.config.mjs
â”‚
â”œâ”€ prisma/                  # ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
â”‚   â””â”€ schema.prisma
â”‚
â”œâ”€ src/
â”‚   â”œâ”€ app/                 # App Router
â”‚   â”‚   â”œâ”€ layout.tsx
â”‚   â”‚   â”œâ”€ page.tsx         # / â€“ ãƒãƒ£ãƒƒãƒˆ UI
â”‚   â”‚   â””â”€ api/
â”‚   â”‚       â”œâ”€ rag/route.ts         # Retriever â†’ Gemini ç”Ÿæˆ
â”‚   â”‚       â””â”€ webhook/route.ts     # GitHub WebHook çµŒç”±ã§å·®åˆ† Ingest
â”‚   â”‚
â”‚   â”œâ”€ components/
â”‚   â”‚   â”œâ”€ ChatBox.tsx
â”‚   â”‚   â”œâ”€ MessageBubble.tsx
â”‚   â”‚   â”œâ”€ RepoSidebar.tsx
â”‚   â”‚   â””â”€ Loader.tsx
â”‚   â”‚
â”‚   â”œâ”€ lib/
â”‚   â”‚   â”œâ”€ github-fetch.ts         # Octokit ãƒ©ãƒƒãƒ‘ï¼ˆREST/GraphQLï¼‰
â”‚   â”‚   â”œâ”€ preprocessor.ts         # ã‚³ãƒ¼ãƒ‰ãƒ»Markdown ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°
â”‚   â”‚   â”œâ”€ chunker.ts              # Recursive splitterï¼ˆé–¢æ•°ï¼æ®µè½å˜ä½ï¼‰
â”‚   â”‚   â”œâ”€ embedder.ts             # OpenAI / bge-large ãªã©
â”‚   â”‚   â”œâ”€ vector-store.ts         # pgvector or Pinecone
â”‚   â”‚   â””â”€ rag-pipeline.ts         # æ¤œç´¢â†’MMRâ†’Gemini ç”Ÿæˆ
â”‚   â”‚
â”‚   â”œâ”€ styles/                     # ã‚°ãƒ­ãƒ¼ãƒãƒ« CSS
â”‚   â””â”€ types/                      # zod schema & å‹
â”‚
â””â”€ scripts/
    â””â”€ initial-index.ts            # ãƒ•ãƒ«ã‚¯ãƒ­ãƒ¼ãƒ©ï¼ˆCLIï¼‰
```

*Edge Runtime* ã§ webhook â†’ ingest â†’ embed ã‚’å®Œçµã•ã›ã€ãƒ•ãƒ­ãƒ³ãƒˆã¨ã¯ **`/api/rag`** ã§ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¿œç­”ã€‚

---

### 2. è¦ä»¶å®šç¾©ï¼ˆæŠœç²‹ï¼‰

| åŒºåˆ†      | è¦ä»¶                                          | æŠ€è¡“ãƒã‚¤ãƒ³ãƒˆï¼æ‰¹åˆ¤çš„ãƒ¡ãƒ¢                                         |
| ------- | ------------------------------------------- | ---------------------------------------------------- |
| **æ©Ÿèƒ½**  | PAT èªè¨¼ã§ private repo ã‚’å…¨é‡ã‚¯ãƒ­ãƒ¼ãƒ«ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ãƒ»Issueãƒ»PRï¼‰ | åˆå›ã¯ `scripts/initial-index.ts`ã€ä»¥å¾Œã¯ WebHook å·®åˆ†        |
|         | Top-k + MMR æ¤œç´¢çµæœã‚’ Gemini ã«ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ³¨å…¥          | ã‚³ãƒ¼ãƒ‰ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ **åˆ¥ index** ã«ã—ã¦é‡ã¿èª¿æ•´                      |
|         | ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‚’ãƒ¦ãƒ¼ã‚¶åˆ¥ã«ä¿å­˜ãƒ»å†å‘¼ã³å‡ºã—                        | Prisma + Postgres                                    |
| **éæ©Ÿèƒ½** | å¹³å‡å¿œç­” < 5 sï¼ˆãƒˆãƒƒãƒ— 10 ãƒãƒ£ãƒ³ã‚¯åŸ‹ã‚è¾¼ã¿åˆè¨ˆ < 9 k tokenï¼‰   | Stream chunk-by-chunk                                |
|         | GitHub Rate-Limit æ¯æ¸‡æ™‚ã¯ãƒãƒƒã‚¯ã‚ªãƒ•ï¼†ãƒªãƒˆãƒ©ã‚¤            | `Retry-After` header æº–æ‹                               |
|         | GPL ç­‰ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æ¤œçŸ¥ã§ç”Ÿæˆæ–‡ã«å‡ºå…¸ãƒ•ãƒƒã‚¿æŒ¿å…¥                    | `license` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿åŒ–                               |
| **é‹ç”¨**  | WebHook å¤±æ•—æ™‚ã« Dead-letter Queue ã¸è½ã¨ã™         | Supabase RLS + cron                                  |
|         | Embedding/ç”Ÿæˆãƒ¢ãƒ‡ãƒ«å·®ã—æ›¿ãˆã‚’ 1 æ—¥ã§å®Œäº†ã§ãã‚‹              | `embedder.ts` / `rag-pipeline.ts` ã‚’ Strategy Pattern |

---

### 3. UI & CSSï¼ˆTailwind + shadcn/ui æœ€å°ã‚¹ãƒ‹ãƒšãƒƒãƒˆï¼‰

#### 3-1. globals.css

```css
@tailwind base;
@tailwind components;
@tailwind utilities;

html { @apply bg-slate-50 text-slate-800 antialiased; }
```

#### 3-2. layout.tsx

```tsx
import '@/styles/globals.css';
import { RepoSidebar } from '@/components/RepoSidebar';

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="ja">
      <body className="flex min-h-screen">
        <RepoSidebar />
        <main className="flex-1 p-6 overflow-y-auto">{children}</main>
      </body>
    </html>
  );
}
```

#### 3-3. ChatBox.tsxï¼ˆæŠœç²‹ï¼‰

```tsx
'use client';
import { useChat } from 'ai/react';
import { MessageBubble } from './MessageBubble';
import { Loader } from './Loader';

export function ChatBox() {
  const { messages, input, handleInputChange, handleSubmit, isLoading } = useChat({
    api: '/api/rag',
  });

  return (
    <>
      <div className="flex-1 space-y-2 overflow-y-auto rounded-xl border bg-white p-4 shadow">
        {messages.map((m) => (
          <MessageBubble key={m.id} role={m.role} content={m.content} />
        ))}
        {isLoading && <Loader />}
      </div>

      <form onSubmit={handleSubmit} className="mt-3 flex gap-2">
        <input
          value={input}
          onChange={handleInputChange}
          placeholder="ã‚¯ã‚¨ãƒªã‚’å…¥åŠ›..."
          className="flex-1 rounded-lg border px-3 py-2 text-sm shadow focus:ring-2 focus:ring-indigo-500"
        />
        <button
          type="submit"
          className="rounded-lg bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow hover:bg-indigo-700"
        >
          é€ä¿¡
        </button>
      </form>
    </>
  );
}
```

#### 3-4. RepoSidebar.tsx

```tsx
export function RepoSidebar() {
  const repos = [{ id: 1, name: 'org/api-server' }, { id: 2, name: 'org/web-ui' }];

  return (
    <aside className="w-64 shrink-0 border-r bg-slate-100 p-4">
      <h2 className="mb-4 text-lg font-semibold">å¯¾è±¡ãƒªãƒã‚¸ãƒˆãƒª</h2>
      <ul className="space-y-2">
        {repos.map((r) => (
          <li
            key={r.id}
            className="truncate rounded-md bg-white p-2 text-sm shadow hover:bg-indigo-50"
          >
            {r.name}
          </li>
        ))}
      </ul>
    </aside>
  );
}
```

#### 3-5. Loader.tsx

```tsx
import { motion } from 'framer-motion';

export function Loader() {
  return (
    <motion.div
      className="mx-auto h-6 w-6 rounded-full border-2 border-indigo-600 border-t-transparent"
      animate={{ rotate: 360 }}
      transition={{ repeat: Infinity, duration: 1, ease: 'linear' }}
    />
  );
}
```

---

### 4. æ³¨æ„ã™ã¹ãè¨­è¨ˆãƒã‚¤ãƒ³ãƒˆï¼ˆçŸ­è©•ï¼‰

| èª²é¡Œ                    | ã‚ã‚ŠãŒã¡ãªå¤±ç­–              | æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ                                    |
| --------------------- | -------------------- | ------------------------------------------ |
| å·¨å¤§ monorepo ã®åˆå›ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ | Edge ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ         | GH Actions + DB ãƒãƒ«ã‚¯ import ã«åˆ‡ã‚Šæ›¿ãˆ           |
| PR / Issue ã®ã‚¹ãƒ‘ãƒ æ··å…¥     | â€œğŸ‘â€ã ã‘ã®ã‚³ãƒ¡ãƒ³ãƒˆã¾ã§ embed  | reaction æ•°ãƒ»é•·ã•ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°                      |
| ã‚³ãƒ¼ãƒ‰ãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ··åœ¨ãƒãƒ£ãƒ³ã‚¯      | å›ç­”ã®é€¸è„±ï¼ˆhallucinationï¼‰ | index ã‚’åˆ†é›¢ã— MMR ã§çµ±åˆ                         |
| Rate-Limit æ¯æ¸‡         | ãƒªãƒˆãƒ©ã‚¤ç„¡é™ãƒ«ãƒ¼ãƒ— â†’ 503      | back-off & `Retry-After`ã€æ®‹æ  10% ã§ queue åœæ­¢ |
| GPL ã‚³ãƒ¼ãƒ‰ç‰‡ã®å†ç”Ÿæˆ          | ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æ±šæŸ“              | å–å¾—å…ƒã® license ãƒ¡ã‚¿ã‚’è¿½è·¡ã—å›ç­”æœ«å°¾ã« CITATION è‡ªå‹•ä»˜ä¸     |

---

å¿…è¦ã«å¿œã˜ã¦ **Webhook ãƒãƒ³ãƒ‰ãƒ©** ã‚„ **åˆå›ã‚¯ãƒ­ãƒ¼ãƒ« CLI** ã®ã‚³ãƒ¼ãƒ‰ã¾ã§æ˜ã‚Šä¸‹ã’ã‚‰ã‚Œã¾ã™ã€‚
ä»–ã«è©°ã‚ãŸã„ç‚¹ãŒã‚ã‚Œã°ã©ã†ãã€‚
